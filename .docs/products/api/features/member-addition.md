# メンバー追加

プロジェクトにメンバーを追加するユースケースです。

## アクター

- プロジェクト管理者（OWNER または ADMIN ロールを持つユーザー）

## 前提条件

- ユーザーがシステムにログインしている
- ユーザーがプロジェクトのOWNERまたはADMINロールを持っている
- 追加対象のユーザーがシステムに登録されている

## 成功シナリオ

1. プロジェクト管理者がプロジェクトのメンバー管理ページにアクセスする
2. プロジェクト管理者が「メンバー追加」ボタンをクリックする
3. システムがメンバー追加フォームを表示する
4. プロジェクト管理者が追加するユーザーのメールアドレスを入力する
5. プロジェクト管理者がユーザーに付与するロール（ADMIN、MEMBER、VIEWER）を選択する
6. プロジェクト管理者が「追加」ボタンをクリックする
7. システムがメールアドレスの形式を検証する
8. システムがメールアドレスに対応するユーザーを検索する
9. システムがユーザーがプロジェクトに既に所属していないことを確認する
10. システムがプロジェクトメンバーとしてユーザーを追加する
11. システムが追加されたユーザーに通知を送信する
12. システムがメンバー追加完了の通知を表示する
13. システムがメンバー一覧を更新して表示する

## 代替シナリオ

### メールアドレスに対応するユーザーが存在しない場合

8a. システムがメールアドレスに対応するユーザーが存在しないことを検出する
8b. システムがエラーメッセージを表示する
8c. システムが招待メールを送信するオプションを提案する

### ユーザーが既にプロジェクトメンバーである場合

9a. システムがユーザーが既にプロジェクトメンバーであることを検出する
9b. システムがエラーメッセージを表示する
9c. プロジェクト管理者が別のユーザーを選択するか、既存メンバーのロール変更を行う

## 例外シナリオ

### システムエラーが発生した場合

10a. システムがメンバー追加中にエラーが発生する
10b. システムがエラーメッセージを表示する
10c. システムが管理者にエラーを通知する
10d. プロジェクト管理者が後で再試行するよう促される

## ビジネスルール

- プロジェクトメンバーの追加はOWNERまたはADMINロールを持つユーザーのみが実行できる
- 同一プロジェクト内で同一ユーザーが複数のメンバーとして登録されることはない
- メンバーのロールは"ADMIN", "MEMBER", "VIEWER"のいずれかでなければならない（OWNERロールは作成時のみ付与される）
- プロジェクトメンバー数はプロジェクトの種類によって制限される（無料プロジェクトは最大10人、有料プロジェクトは最大100人など）

## 関連モデル

- [プロジェクトメンバー](../models/project-member.md)
- [プロジェクト](../models/project.md)
- [ユーザー](../models/user.md)
- [プロジェクト通知](../models/project-notification.md)
